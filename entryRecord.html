<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <link rel="stylesheet" href="./bootstrap.css"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B"
    crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    

    <link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.min.css">

    <!-- footer -->
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet"> -->

    <script>
        var config = {
            apiKey: "AIzaSyDQ4Ic9yAYfaexhXCpElPv-DJr2la5ZOxE",
            authDomain: "patienttracker-a460e.firebaseapp.com",
            databaseURL: "https://patienttracker-a460e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "patienttracker-a460e",
            storageBucket: "patienttracker-a460e.appspot.com",
            messagingSenderId: "402200494814",
            appId: "1:402200494814:web:cd2ad0245929a73343f84f"
        };

    </script>


    <title>Patient Tracker App</title>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <h4 class="text-center text-white">
                <i class="fa fa-user-md"></i> Patient Tracker App</h4>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="bg-faded navbar-toggler-icon"></span>
    </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link text-white " href="./aboutUs.html">
                        <i class="fa fa-info-circle"></i> &nbsp;About us
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link text-white " href="./dashboard.html">
                        <i class="fa fa-address-card"></i> &nbsp;Dashboard
                    </a>
                </li>
                <li>
                    <a id="logoutBtn" class="nav-link text-white logout">
                        <i class="fa fa-sign-out"> </i> &nbsp;Logout</a>
                </li>

        </div>
    </nav>


    <br>
    <br>
    <br>
    <section class="my-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <div class="card">
                        <div class=" text-white text-center ">
                            <br>
                            <h1 class="text-dark appName">
                                <i class="fa fa-pencil"></i>
                                Enter Patient Record
                            </h1>
                        </div>
                        <!-- card header-->

                        <div class="card-body">
                            <form id="appointmentForm">
                                <div class="form-group">
                                    <input type="number" id="patientId" placeholder="Patient ID" name="patientID" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="patientlasttName" class="text-muted">Appointment Date:</label>
                                    <input type="date" id="appointmentDate" placeholder="Appointment Date" name="lname" class="form-control">
                                </div>

                                <div class="form-group">
                                    <input type="text" id="patientName" placeholder="Patient Name" name="fname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="text" id="disease" placeholder="Disease" name="lname" class="form-control">
                                </div>

                                <div class="form-group">
                                    <input type="text" id="medications" placeholder="Medications" name="lname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="weight" placeholder="Weight" name="lname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="growth" placeholder="Growth" name="lname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="bloodGroup" class="text-muted">Blood Group: </label>
                                    <select name="bloodGroup" placeholder="Blood Group" id="bloodGroup" class="form-control">
                                        <option id="select" selected>Select</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <input type="number" id="age" placeholder="Age" name="lname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="bloodPressure" placeholder="Blood Pressure" name="lname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="pulseRate" placeholder="Pulse rate" name="lname" class="form-control">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="sugar" placeholder="Sugar" name="lname" class="form-control">
                                </div>

                                <button class="btn btn-block btn-primary text-white " type="submit">
                                    <h5>Submit</h5>
                                </button>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="mt-4 py-4 footer-length"></footer>

    <script type="module" >
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js'
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js'
    
        // If you enabled Analytics in your project, add the Firebase SDK for Google Analytics
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-analytics.js'
    
        // Add Firebase products that you want to use
        import { getAuth, createUserWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js'
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js'
        
        const config = {
            apiKey: "AIzaSyDQ4Ic9yAYfaexhXCpElPv-DJr2la5ZOxE",
            authDomain: "patienttracker-a460e.firebaseapp.com",
            databaseURL: "https://patienttracker-a460e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "patienttracker-a460e",
            storageBucket: "patienttracker-a460e.appspot.com",
            messagingSenderId: "402200494814",
            appId: "1:402200494814:web:cd2ad0245929a73343f84f"
        };
        const firebase = initializeApp(config)
        var auth = getAuth()
        document.getElementById("logoutBtn").addEventListener("click", function () {
            signOut(auth)
                .then(function () {
                    console.log("Logged out!");
                }).catch(function (error) {
                    console.log("Error: ", error);
                })
        });

        onAuthStateChanged(auth, function (user) {
            if (!user) {
                window.location.href = "./LoginPage.html";
            }
        });


        let user = localStorage.getItem("user");

        user = JSON.parse(user);

        // Writing in database

        const onSubmit = (event) => {
            if(event)
            event.preventDefault();

            let patientId = document.getElementById("patientId").value;
            let appointmentDate = document.getElementById("appointmentDate").value;
            let patientName = document.getElementById("patientName").value;
            let disease = document.getElementById("disease").value;
            let medications = document.getElementById("medications").value;
            let weight = document.getElementById("weight").value;
            let growth = document.getElementById("growth").value;
            let bloodGroup = document.getElementById("bloodGroup").value;
            if (bloodGroup === "Select") {
                alert("Choose your blood group!");
            }
            else {
                var selectedItem = bloodGroup;
            }

            let age = document.getElementById("age").value;
            let bloodPressure = document.getElementById("bloodPressure").value;
            let pulseRate = document.getElementById("pulseRate").value;
            let sugar = document.getElementById("sugar").value;

            let patientObj = {
                patientId,
                appointmentDate,
                patientName,
                disease,
                medications,
                weight,
                growth,
                bloodGroup,
                age,
                bloodPressure,
                pulseRate,
                sugar
            };
            console.log(patientObj);
            console.log(user.uid);
            console.log(patientObj.patientName);
            console.log(user.uid);
            let db = getDatabase(firebase)
            set(ref(db , "users/" + user.uid + "/patient/" + patientObj.patientName + "/Appointments/"+ patientObj.appointmentDate ), (patientObj))
                .then(() => {
                    document.getElementById("patientId").value = '';
                    document.getElementById("appointmentDate").value = '';
                    document.getElementById("patientName").value = '';
                    document.getElementById("disease").value = '';
                    document.getElementById("medications").value = '';
                    document.getElementById("weight").value = '';
                    document.getElementById("growth").value = '';
                    document.getElementById("bloodGroup").value = document.getElementById("select").value;
                    document.getElementById("age").value = '';
                    document.getElementById("bloodPressure").value = '';
                    document.getElementById("pulseRate").value = '';
                    document.getElementById("sugar").value = ''

                }).catch((error) => {
                    console.log(error.message);
                })
            alert("Record saved successfully")
            }

        document.getElementById("appointmentForm").addEventListener("submit", onSubmit);

        onSubmit()

// Reading from DB;
    // firebase.database().ref(user.uid).child("Patients").on("value" , (snapshot)=>{
    //     let data = snapshot.val();
    //     console.log(data);

    //     let patientArray = [];
    //     for(let key in data) {
    //          patientArray.push(data[key]);
    //     }
    //     console.log(patientArray);

    //     patientArray.map( (item, index) => {
    //         console.log(item);
    //         let history = 
    //         `<tr>
    //             <th>Patient ID</th>
    //             <td>${item.patientId}</td>
    //         </tr>
    //         <tr>
    //             <th>Appointment Date</th>
    //             <td>${item.appointmentDate}</td>
    //         </tr>
    //         <tr>
    //             <th>Patient Name</th>
    //             <td>${item.patientName}</td>
    //         </tr>
    //         <tr>
    //             <th>Disease</th>
    //             <td>${item.disease}</td>
    //         </tr>
    //         <tr>
    //             <th>Medications</th>
    //             <td>${item.medications}</td>
    //         </tr>
    //         <tr>
    //             <th>Weight</th>
    //             <td>${item.weight}</td>
    //         </tr>
    //         <tr>
    //             <th>Growth</th>
    //             <td>${item.growth}</td>
    //         </tr>
    //         <tr>
    //             <th>Blood Group</th>
    //             <td>${item.bloodGroup}</td>
    //         </tr>
    //         <tr>
    //             <th>Age</th>
    //             <td>${item.age}</td>
    //         </tr>
    //         <tr>
    //             <th>Blood Pressure</th>
    //             <td>${item.bloodPressure}</td>
    //         </tr>
    //         <tr>
    //             <th>Pulse Rate</th>
    //             <td>${item.pulseRate}</td>
    //         </tr>
    //         <tr>
    //             <th>Sugar</th>
    //             <td>${item.sugar}</td>
    //         </tr> `
    //         document.getElementById("historyTable").innerHTML += history;
    //     });




    // });



    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    "sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
    crossorigin="anonymous"></script>

</body>


</html>